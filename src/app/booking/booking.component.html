<p>booking works!</p>
<!-- 
There should be only one form-group in a page.

If we want to add an extra form it has to be nested form or another form, the another form can be created just by using the formbuilder.group()
-->
<div>
  <button mat-flat-button (click)="addPassport()">Add Passport</button>
</div>

<br>

<div>
  <button mat-flat-button (click)="deletePassport()">Delete Passport</button>
</div>
<br>

<form class="example-form" [formGroup]="bookingForm" (ngSubmit)="addBooking()">

  <mat-form-field class="example-full-width" *ngIf="bookingForm.get('passport')">
    <mat-label>Passport Number</mat-label>
    <input
      type="text"
      matInput
      formControlName="passport"
      placeholder="Passport Number"
    />
  </mat-form-field>

  <mat-form-field class="example-full-width">
    <mat-label>Room Id</mat-label>
    <input
      type="text"
      matInput
      formControlName="roomId"
      placeholder="Provide Room Id"
    />
    <!-- @if (emailFormControl.hasError('email') &&
    !emailFormControl.hasError('required')) {
    <mat-error>Please enter a valid email address</mat-error>
    } @if (emailFormControl.hasError('required')) {
    <mat-error>Email is <strong>required</strong></mat-error>
    } -->
  </mat-form-field>

  <mat-form-field class="example-full-width">
    <mat-label>Email</mat-label>
    <input
      type="email"
      matInput
      formControlName="guestEmail"
      placeholder="Ex. pat@example.com"
    />
    <mat-error *ngIf="bookingForm.get('guestEmail')?.hasError('email')">Email has to be in correct format.</mat-error>
  </mat-form-field>

  <mat-form-field class="example-full-width">
    <mat-label>Name</mat-label>
    <input
      type="text"
      matInput
      formControlName="guestName"
      placeholder="Provide Name"
    />
  </mat-form-field>

  <mat-form-field class="example-full-width">
    <mat-label>Mobile Number</mat-label>
    <input
      type="text"
      matInput
      formControlName="mobileNumber"
      placeholder="Provide Mobile Number"
    />
  </mat-form-field>

  <mat-form-field class="example-full-width">
    <mat-label>Chek-in date</mat-label>
    <input matInput [matDatepicker]="picker1" formControlName="checkinDate" />
    <mat-datepicker-toggle
      matIconSuffix
      [for]="picker1"
    ></mat-datepicker-toggle>
    <mat-datepicker #picker1></mat-datepicker>
  </mat-form-field>

  <mat-form-field class="example-full-width">
    <mat-label>Check-out date</mat-label>
    <input matInput [matDatepicker]="picker2" formControlName="checkoutDate" />
    <mat-datepicker-toggle
      matIconSuffix
      [for]="picker2"
    ></mat-datepicker-toggle>
    <mat-datepicker #picker2></mat-datepicker>
  </mat-form-field>

  <mat-form-field class="example-full-width">
    <mat-label>Booking date</mat-label>
    <input matInput [matDatepicker]="picker3" formControlName="bookingDate" />
    <mat-datepicker-toggle
      matIconSuffix
      [for]="picker3"
    ></mat-datepicker-toggle>
    <mat-datepicker #picker3></mat-datepicker>
  </mat-form-field>

  <div formGroupName="address">
    <mat-accordion class="example-headers-align" multi>
      <mat-expansion-panel
        (opened)="panelOpenState.set(true)"
        (closed)="panelOpenState.set(false)"
      >
        <mat-expansion-panel-header>
          <mat-panel-title> Address </mat-panel-title>
        </mat-expansion-panel-header>
        <mat-form-field class="example-full-width">
          <mat-label>Address Line1</mat-label>
          <input
            type="text"
            matInput
            formControlName="addressLine1"
            placeholder="Provide Street Address"
          />
          <mat-error *ngIf="bookingForm.get('address.addressLine1')?.hasError('required')">Address Line 1 is required!</mat-error>
        </mat-form-field>

        <mat-form-field class="example-full-width">
          <mat-label>Address Line2</mat-label>
          <input
            type="text"
            matInput
            formControlName="addressLine2"
            placeholder="Provide Apt number"
          />
        </mat-form-field>

        <mat-form-field class="example-full-width">
          <mat-label>City</mat-label>
          <input
            type="text"
            matInput
            formControlName="city"
            placeholder="Provide City"
          />
        </mat-form-field>

        <mat-form-field class="example-full-width">
          <mat-label>State</mat-label>
          <input
            type="text"
            matInput
            formControlName="state"
            placeholder="Provide State"
          />
        </mat-form-field>

        <mat-form-field class="example-full-width">
          <mat-label>Country</mat-label>
          <input
            type="text"
            matInput
            formControlName="country"
            placeholder="Provide Country"
          />
        </mat-form-field>

        <mat-form-field class="example-full-width">
          <mat-label>zipcode</mat-label>
          <input
            type="text"
            matInput
            formControlName="zipCode"
            placeholder="Provide Zipcode"
          />
        </mat-form-field>
      </mat-expansion-panel>
    </mat-accordion>
  </div>

  <div>
    <button mat-flat-button (click)="addGuest()">Add Guest</button>
  </div>

  <div formArrayName="guests">
    <mat-accordion class="example-headers-align" multi>
      <mat-expansion-panel
        (opened)="panelOpenState.set(true)"
        (closed)="panelOpenState.set(false)"
      >
        <mat-expansion-panel-header>
          <mat-panel-title> Guests </mat-panel-title>
        </mat-expansion-panel-header>
      
    <div *ngFor="let guest of guests.controls; let i = index">
      <div [formGroupName]="i">
        <mat-accordion class="example-headers-align" multi>
          <mat-expansion-panel
            (opened)="panelOpenState.set(true)"
            (closed)="panelOpenState.set(false)"
          >
            <mat-expansion-panel-header>
              <mat-panel-title> Guest {{i}} </mat-panel-title>
            </mat-expansion-panel-header>
        <mat-form-field class="example-full-width">
          <mat-label>Guest Name</mat-label>
          <input
            type="text"
            matInput
            formControlName="guestName"
            placeholder="Provide Guest Name"
          />
          <mat-error *ngIf="bookingForm.get(['guests',i,'guestName'])?.hasError('required')">Guest Name is required!</mat-error>
        </mat-form-field>

        <mat-form-field class="example-full-width">
          <mat-label>Age</mat-label>
          <input
            type="number"
            matInput
            formControlName="age"
            placeholder="Age"
          />
        </mat-form-field>
        </mat-expansion-panel>
        </mat-accordion>
      </div>
      <div>
        <button mat-flat-button (click)="removeGuest(i)">Remove Guest</button>
      </div>
    </div>
  </mat-expansion-panel>
 </mat-accordion>
  </div>

  <div>
    <mat-checkbox class="example-margin" formControlName="tnc">Terms & Conditions</mat-checkbox>
  </div>

  <div>
    <button mat-flat-button [disabled]="bookingForm.invalid">Book Room</button>
  </div>
</form>
